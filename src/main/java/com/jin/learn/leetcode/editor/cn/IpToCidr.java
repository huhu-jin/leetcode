//  [751]IP åˆ° CIDR

//ç»™å®šä¸€ä¸ªèµ·å§‹ IP åœ°å€ ip å’Œä¸€ä¸ªæˆ‘ä»¬éœ€è¦åŒ…å«çš„ IP çš„æ•°é‡ nï¼Œè¿”å›ç”¨åˆ—è¡¨ï¼ˆæœ€å°å¯èƒ½çš„é•¿åº¦ï¼‰è¡¨ç¤ºçš„ CIDRå—çš„èŒƒå›´ã€‚ 
//
// CIDR å—æ˜¯åŒ…å« IP çš„å­—ç¬¦ä¸²ï¼Œåæ¥æ–œæ å’Œå›ºå®šé•¿åº¦ã€‚ä¾‹å¦‚ï¼šâ€œ123.45.67.89/20â€ã€‚å›ºå®šé•¿åº¦ â€œ20â€ è¡¨ç¤ºåœ¨ç‰¹å®šçš„èŒƒå›´ä¸­å…¬å…±å‰ç¼€ä½çš„é•¿åº¦ã€‚
// 
//
// ç¤ºä¾‹ 1ï¼š 
//
// è¾“å…¥ï¼šip = "255.0.0.7", n = 10
//è¾“å‡ºï¼š["255.0.0.7/32","255.0.0.8/29","255.0.0.16/32"]
//è§£é‡Šï¼š
//è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ—¶ï¼Œåˆå§‹IPåœ°å€å¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸ºæ¸…æ™°èµ·è§æ·»åŠ äº†ç©ºæ ¼ï¼‰ï¼š
//255.0.0.7 -> 11111111 00000000 00000000 00000111
//åœ°å€ "255.0.0.7/32" è¡¨ç¤ºä¸ç»™å®šåœ°å€æœ‰ç›¸åŒçš„ 32 ä½å‰ç¼€çš„æ‰€æœ‰åœ°å€ï¼Œ
//åœ¨è¿™é‡Œåªæœ‰è¿™ä¸€ä¸ªåœ°å€ã€‚
//
//åœ°å€ "255.0.0.8/29" è¡¨ç¤ºä¸ç»™å®šåœ°å€æœ‰ç›¸åŒçš„ 29 ä½å‰ç¼€çš„æ‰€æœ‰åœ°å€ï¼š
//255.0.0.8 -> 11111111 00000000 00000000 00001000
//æœ‰ç›¸åŒçš„ 29 ä½å‰ç¼€çš„åœ°å€å¦‚ä¸‹ï¼š
//11111111 00000000 00000000 00001000
//11111111 00000000 00000000 00001001
//11111111 00000000 00000000 00001010
//11111111 00000000 00000000 00001011
//11111111 00000000 00000000 00001100
//11111111 00000000 00000000 00001101
//11111111 00000000 00000000 00001110
//11111111 00000000 00000000 00001111
//
//åœ°å€ "255.0.0.16/32" è¡¨ç¤ºä¸ç»™å®šåœ°å€æœ‰ç›¸åŒçš„ 32 ä½å‰ç¼€çš„æ‰€æœ‰åœ°å€ï¼Œ
//è¿™é‡Œåªæœ‰ 11111111 00000000 00000000 00010000ã€‚
//
//æ€»ä¹‹ï¼Œç­”æ¡ˆæŒ‡å®šäº†ä» 255.0.0.7 å¼€å§‹çš„ 10 ä¸ª IP çš„èŒƒå›´ã€‚
//
//æœ‰ä¸€äº›å…¶ä»–çš„è¡¨ç¤ºæ–¹æ³•ï¼Œä¾‹å¦‚ï¼š
//["255.0.0.7/32","255.0.0.8/30", "255.0.0.12/30", "255.0.0.16/32"],
//ä½†æ˜¯æˆ‘ä»¬çš„ç­”æ¡ˆæ˜¯æœ€çŸ­å¯èƒ½çš„ç­”æ¡ˆã€‚
//
//å¦å¤–è¯·æ³¨æ„ä»¥ "255.0.0.7/30" å¼€å§‹çš„è¡¨ç¤ºä¸æ­£ç¡®ï¼Œ
//å› ä¸ºå…¶åŒ…æ‹¬äº† 255.0.0.4 = 11111111 00000000 00000000 00000100 è¿™æ ·çš„åœ°å€ï¼Œ
//è¶…å‡ºäº†éœ€è¦è¡¨ç¤ºçš„èŒƒå›´ã€‚
// 
//
// 
//
// æ³¨ï¼š 
//
// 
// ip æ˜¯æœ‰æ•ˆçš„ IPv4 åœ°å€ã€‚ 
// æ¯ä¸€ä¸ªéšå«åœ°å€ ip + x (å…¶ä¸­ x < n) éƒ½æ˜¯æœ‰æ•ˆçš„ IPv4 åœ°å€ã€‚ 
// n ä¸ºæ•´æ•°ï¼ŒèŒƒå›´ä¸º [1, 1000]ã€‚ 
// 
//
// 
// Related Topics ä½è¿ç®— å­—ç¬¦ä¸² 
// ğŸ‘ 19 ğŸ‘ 0


package com.jin.learn.leetcode.editor.cn;

import org.testng.annotations.Test;

import java.util.ArrayList;
import java.util.List;


public class IpToCidr{
  
  
    //leetcode submit region begin(Prohibit modification and deletion)
class Solution {
        // ä¸ä¼š
//        æ˜ç™½äº†ä¸Šé¢çš„è§„åˆ™ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£å¼€å§‹å°†ä¸€å †è¿ç»­ip è½¬åŒ–ä¸º CIDRæ®µçš„è´ªå¿ƒå¯»æ‰¾ï¼š
//
//        æ‹¿å½“å‰çš„èµ·ç‚¹ipåšstart
//        æƒ³è¦ç”¨çš„æ®µæ•°å°‘ï¼Œé‚£æˆ‘ä»¬å¿…é¡»ç”¨å°½é‡å¤§çš„mask
//                é€šè¿‡startæœ«å°¾0çš„æ•°é‡æ¥åˆ¤æ–­å¯ä»¥ä½¿ç”¨çš„maské•¿åº¦ä¸Šé™
//        maské•¿åº¦ä¸Šé™åŒæ—¶è¿˜å—å‰©ä½™ipæ•° n çš„å½±å“ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½åŒ…å«å¤šä½™çš„ip
//        ç”¨å®ƒä»¬ç»„æˆå¯ä»¥ç»„æˆçš„æœ€å¤§ CIDR
//        æ ¹æ®ç»„æˆçš„CIDRæ®µä¸­çš„ipæ•°é‡å°†nç¼©å°ï¼ŒæŠŠstartæ”¹ä¸ºCIDRä¹‹åçš„ç¬¬ä¸€ä¸ªip
//        å¦‚æœnè¿˜ä¸ä¸º0ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚


        public List<String> ipToCIDR (String ip, int n){
            int start = toInt(ip); //å°†ipè½¬åŒ–ä¸ºæ•´æ•°
            List<String> ans = new ArrayList<>();
            while (n > 0) {
                int trailingZeros = Integer.numberOfTrailingZeros(start);
                int mask = 0,bitsInCIDR = 1;
                //è®¡ç®—mask
                while (bitsInCIDR < n && mask < trailingZeros) {
                    bitsInCIDR <<= 1;
                    mask++;
                }
                if (bitsInCIDR > n) {
                    bitsInCIDR >>= 1;
                    mask--;
                }

                ans.add(toString(start, 32 - mask));
                n -= bitsInCIDR;
                start += (bitsInCIDR);
            }
            return ans;
        }

        private String toString(int number, int range) {
            final int WORD_SIZE = 8;
            StringBuilder buffer = new StringBuilder();
            for (int i = 3; i >= 0; --i) {
                buffer.append(((number >> (i * WORD_SIZE)) & 255));
                buffer.append(".");
            }
            buffer.setLength(buffer.length() - 1);
            buffer.append("/").append(range);
            return buffer.toString();
        }

        private int toInt(String ip) {
            String[] strs = ip.split("\\.");
            int sum = 0;
            for (String str : strs) {
                sum *= 256;
                sum += Integer.parseInt(str);
            }
            return sum;
        }

}
//leetcode submit region end(Prohibit modification and deletion)

    
    @Test
    public void testCase(){
        new Solution().ipToCIDR("127.0.0.1", 15);
    }
  
}